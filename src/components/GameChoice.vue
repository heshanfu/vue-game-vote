<template>
	<figure class="game" v-bind:title="`âœ” Vote for ${game.text}`" v-on:click="vote(game)" v-if="game.id">
		<img class="game__cover" v-bind:src="require(`../${game.img}`)" :alt="game.text">
		<figcaption class="game__description">
			<h3 class="game__title">{{ game.text }}</h3>

			<p class="game__votes" v-if="tally > 0" v-bind:title="`Vote count for ${game.text}`">
				<span v-for="idx in tally" :key="idx" aria-hidden="true">&#9679;</span>
				<span class="sr-only">{{ `${tally} votes` }}</span>
			</p>
		</figcaption>
	</figure>
</template>

<script>
	import Game from '../types/Game';

	export default {
		name: 'GameChoice',
		props: {
			...Game
		},
		methods: {
			vote: function (game) {
				if (this.$parent.voters > 0) {
					this.$parent.votes.push(game);
				}

				--this.$parent.voters;
			}
		},
		computed: {
			tally: function () {
				return this.$parent.votes.filter(vote => {
					return vote.id === this.game.id;
				}).length;
			}
		}
	};
</script>

<style lang="scss">
	@import '../css/variables.scss';

	@keyframes wiggle {
		20% {
			transform: translateX(5px);
		}

		40% {
			transform: translateX(-5px);
		}

		60% {
			transform: translateX(3px);
		}

		80% {
			transform: translateX(-2px);
		}

		90% {
			transform: translateX(1px);
		}

		100% {
			transform: translateX(0);
		}
	}

	.game {
		cursor: pointer;
		display: flex;
		flex-flow: column nowrap;
		margin: 0 0 $size-base;
		max-width: $size-game-cover;
		padding: 0;

		&__title {
			display: inline-block;
			font-size: 1rem;
			font-weight: 300;
		}

		&__description {
			align-items: center;
			border-radius: $size-border-radius;
			display: flex;
			height: ($size-base * 4) - 5;
			flex-flow: row nowrap;
			justify-content: space-between;
			padding: 0 .666rem;
			transition: background-color .25s ease-out;
		}

		&__cover {
			box-shadow: 0 0 5px rgba(0, 0, 0, .75), 0 2px 10px rgba(0, 0, 0, .5);
			height: $size-game-cover;
			transition: filter .25s ease-out;
			width: $size-game-cover;
			z-index: $zindex-cover;
		}

		&:hover,
		&:focus,
		&:focus-within {
			-webkit-tap-highlight-color: transparent;

			.game__title {
				color: $color-primary;
			}

			.game__description {
				background-color: $color-background-alt;
			}

			.game__cover {
				animation: focus 1s infinite;
			}
		}

		&__votes {
			color: $color-accent;
			line-height: 1;
			text-align: right;
			text-shadow: 0 0 2px rgba(0, 0, 0, .5);
		}
	}

	.no-voters .game {
		cursor: not-allowed;
	}

	.no-voters .game:active {
		animation: wiggle .5s ease;
		animation-iteration-count: 5;

		.game__cover {
			filter: saturate(.33);
			outline: 4px solid $color-dark;
		}
	}
</style>
